var skullSVG =
  '<svg enable-background="new 0 0 48 48" height="100%" version="1.1" viewBox="0 0 48 48" width="48px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="skull"><g><g><path d="M33,46c-0.553,0-1-0.447-1-1V34h1c4.963,0,9-4.037,9-9v-5c0-9.925-8.075-18-18-18S6,10.075,6,20v5c0,4.963,4.037,9,9,9h1     v11c0,0.553-0.447,1-1,1s-1-0.447-1-1v-9.045C8.401,35.448,4,30.729,4,25v-5C4,8.972,12.972,0,24,0s20,8.972,20,20v5     c0,5.729-4.401,10.448-10,10.955V45C34,45.553,33.553,46,33,46z"/></g><g><path d="M21,46c-0.553,0-1-0.447-1-1V35c0-0.553,0.447-1,1-1s1,0.447,1,1v10C22,45.553,21.553,46,21,46z"/></g><g><path d="M27,46c-0.553,0-1-0.447-1-1V35c0-0.553,0.447-1,1-1s1,0.447,1,1v10C28,45.553,27.553,46,27,46z"/></g><g><path d="M33,32c-3.859,0-7-3.141-7-7s3.141-7,7-7s7,3.141,7,7S36.859,32,33,32z M33,20c-2.757,0-5,2.243-5,5s2.243,5,5,5     s5-2.243,5-5S35.757,20,33,20z"/></g><g><path d="M15,32c-3.859,0-7-3.141-7-7s3.141-7,7-7s7,3.141,7,7S18.859,32,15,32z M15,20c-2.757,0-5,2.243-5,5s2.243,5,5,5     s5-2.243,5-5S17.757,20,15,20z"/></g><g><path d="M5.236,18c-0.553,0-1-0.447-1-1s0.447-1,1-1C7.955,16,12,14.136,12,9c0-0.553,0.447-1,1-1s1,0.447,1,1     C14,14.908,9.592,18,5.236,18z"/></g><g><path d="M42.764,18C38.408,18,34,14.908,34,9c0-0.553,0.447-1,1-1s1,0.447,1,1c0,5.136,4.045,7,6.764,7c0.553,0,1,0.447,1,1     S43.316,18,42.764,18z"/></g><g><path d="M25.02,32c-0.005,0.001-0.012,0.001-0.02,0h-2c-0.347,0-0.668-0.18-0.851-0.475s-0.199-0.663-0.044-0.973l1-2     c0.34-0.678,1.449-0.678,1.789,0l0.92,1.84c0.129,0.168,0.205,0.379,0.205,0.607C26.02,31.553,25.572,32,25.02,32z"/></g></g></g></svg>';
var smileySVG =
  '<svg enable-background="new 0 0 48 48" height="100%" version="1.1" viewBox="0 0 48 48" width="48px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="smiley"><g><g><path d="M24,48C10.767,48,0,37.233,0,24S10.767,0,24,0s24,10.767,24,24S37.233,48,24,48z M24,2C11.869,2,2,11.869,2,24     s9.869,22,22,22s22-9.869,22-22S36.131,2,24,2z"/></g><g><path d="M24,42c-8.822,0-16-7.178-16-16c0-0.553,0.448-1,1-1s1,0.447,1,1c0,7.72,6.28,14,14,14s14-6.28,14-14     c0-0.553,0.448-1,1-1s1,0.447,1,1C40,34.822,32.822,42,24,42z"/></g><g><path d="M19,21c-0.552,0-1-0.447-1-1c0-1.654-1.346-3-3-3s-3,1.346-3,3c0,0.553-0.448,1-1,1s-1-0.447-1-1c0-2.757,2.243-5,5-5     s5,2.243,5,5C20,20.553,19.552,21,19,21z"/></g><g><path d="M37,21c-0.552,0-1-0.447-1-1c0-1.654-1.346-3-3-3s-3,1.346-3,3c0,0.553-0.448,1-1,1s-1-0.447-1-1c0-2.757,2.243-5,5-5     s5,2.243,5,5C38,20.553,37.552,21,37,21z"/></g></g></g></svg>';
var crownSVG =
  '<svg enable-background="new 0 0 48 48" height="100%" version="1.1" viewBox="0 0 48 48" width="48px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="Expanded"><g><g><path d="M41.93,38H6.07l-0.251-0.167C2.175,35.413,0,31.363,0,27c0-7.168,5.832-13,13-13c2.069,0,4.128,0.499,5.954,1.442     l-0.918,1.777C16.47,16.41,14.776,16,13,16C6.935,16,2,20.935,2,27c0,3.594,1.744,6.936,4.681,9h34.638     C44.256,33.936,46,30.594,46,27c0-6.065-4.935-11-11-11c-1.778,0-3.473,0.411-5.04,1.222l-0.919-1.775     C30.868,14.5,32.929,14,35,14c7.168,0,13,5.832,13,13c0,4.363-2.175,8.413-5.819,10.833L41.93,38z"/></g><g><path d="M42,48H6c-2.611,0-3.978-2.013-3.978-4.001C2.022,42.012,3.389,40,6,40h36c2.611,0,3.978,2.013,3.978,4.001     C45.978,45.988,44.611,48,42,48z M6,42c-1.46,0-1.978,1.077-1.978,1.999C4.022,44.922,4.54,46,6,46h36     c1.46,0,1.978-1.077,1.978-1.999C43.978,43.078,43.46,42,42,42H6z"/></g><g><path d="M12.695,32.032c-0.411,0-0.795-0.255-0.942-0.663C11.253,29.97,11,28.5,11,27c0-7.168,5.832-13,13-13s13,5.832,13,13     c0,1.49-0.251,2.952-0.746,4.346c-0.186,0.52-0.76,0.789-1.277,0.607c-0.521-0.185-0.792-0.757-0.608-1.277     C34.788,29.498,35,28.262,35,27c0-6.065-4.935-11-11-11s-11,4.935-11,11c0,1.27,0.214,2.513,0.637,3.695     c0.186,0.521-0.085,1.093-0.605,1.278C12.92,32.014,12.807,32.032,12.695,32.032z"/></g><g><path d="M24,12c-3.309,0-6-2.691-6-6s2.691-6,6-6s6,2.691,6,6S27.309,12,24,12z M24,2c-2.206,0-4,1.794-4,4s1.794,4,4,4     s4-1.794,4-4S26.206,2,24,2z"/></g><g><path d="M29,7H19c-0.552,0-1-0.447-1-1s0.448-1,1-1h10c0.552,0,1,0.447,1,1S29.552,7,29,7z"/></g><g><path d="M24,16c-0.552,0-1-0.447-1-1v-4c0-0.553,0.448-1,1-1s1,0.447,1,1v4C25,15.553,24.552,16,24,16z"/></g></g></g></svg>';

var b1 = document.getElementById("audio1");
var b2 = document.getElementById("audio2");
var b3 = document.getElementById("audio3");
var b4 = document.getElementById("audio4");

var myPressArr = [];
var totalSeqArr = [];
var levelSeqArr = [];
var whichLevelStr = 0;
var subLevelStr = 0;
var presses = -1;
function sound(audioID, elID) {
  document.getElementById(audioID).play();
  document.getElementById(elID).className += " highlight";
  setTimeout(function() {
    document.getElementById(elID).className = " button";
  }, 1000);
}
function myPress(elID) {
  presses += 1;
  myPressArr.push(elID);
  console.log("Input:" + myPressArr + " Presses:" + presses);
  if (
    JSON.stringify(myPressArr[presses]) ==
      JSON.stringify(levelSeqArr[whichLevelStr][presses]) &&
    presses < levelSeqArr[whichLevelStr].length - 1
  ) {
    console.log("Yup Enter more");
  } else if (
    JSON.stringify(myPressArr[presses]) ==
      JSON.stringify(levelSeqArr[whichLevelStr][presses]) &&
    presses == levelSeqArr[whichLevelStr].length - 1
  ) {
    document.getElementById("b1").innerHTML = smileySVG;
    document.getElementById("b2").innerHTML = smileySVG;
    document.getElementById("b3").innerHTML = smileySVG;
    document.getElementById("b4").innerHTML = smileySVG;
    console.log("Yup");
    levelUp();
  } else {
    document.getElementById("b1").innerHTML = skullSVG;
    document.getElementById("b2").innerHTML = skullSVG;
    document.getElementById("b3").innerHTML = skullSVG;
    document.getElementById("b4").innerHTML = skullSVG;
    console.log("Nope");
    console.log(levelSeqArr[whichLevelStr]);
    myPressArr = [];
    presses = -1;
    setTimeout(function() {
      playLevel(whichLevelStr);
    }, 2000);
    if(document.getElementById("strict").checked==true){
      reset();
    }
    else{
      return;
    }
  }
}

function reset() {
  myPressArr = [];
  totalSeqArr = [];
  levelSeqArr = [];
  whichLevelStr = 0;
  subLevelStr = 0;
  presses = -1;
  document.getElementById("b1").innerHTML = "";
  document.getElementById("b2").innerHTML = "";
  document.getElementById("b3").innerHTML = "";
  document.getElementById("b4").innerHTML = "";
  document.getElementById("level").innerHTML = "Level 0/20";
  console.log("Game reset");
}

function genTotalSeqArr() {
  for (var i = 1; i <= 20; i++) {
    var rand = "b" + (Math.floor(Math.random() * 4) + 1);
    totalSeqArr.push(rand);
  }
}

function genLevelSeqArr() {
  for (var i = 1; i <= 20; i++) {
    levelSeqArr.push(totalSeqArr.slice(0, i));
  }
}

function genGame() {
  genTotalSeqArr();
  genLevelSeqArr();
}

function playLevelSounds(level, index) {
  window[levelSeqArr[level][index]].play();
    document.getElementById(levelSeqArr[level][index]).className += " highlight";
  setTimeout(function() {
    document.getElementById(levelSeqArr[level][index]).className = " button";
  }, 500);
  myPressArr=[];
  subLevelStr = 0;
  presses = -1;
}

function playLevel(level) {
  for (var i = 0; i <= levelSeqArr[level].length; i++) {
    checkTimeout = setTimeout(
      (function(x) {
        return function() {
          playLevelSounds(level, x);
        };
      })(i),
      1000 * i
    );
  }
}

function levelUp() {
  whichLevelStr += 1;
  myPressArr = [];
  presses = -1;
  if (whichLevelStr < 20) {
    document.getElementById("level").innerHTML =
      "Level " + (whichLevelStr) + "/20";
    console.log(levelSeqArr[whichLevelStr]);
    setTimeout(function() {
      playLevel(whichLevelStr);
    }, 2000);
  } else if (whichLevelStr == 20) {
    console.log("You win!!!");
    document.getElementById("b1").innerHTML = crownSVG;
    document.getElementById("b2").innerHTML = crownSVG;
    document.getElementById("b3").innerHTML = crownSVG;
    document.getElementById("b4").innerHTML = crownSVG;
    setTimeout(function() {
      reset();
    }, 2000);
  }
}

function startGame() {
  if (whichLevelStr === 0) {
    myPressArr = [];
    genGame();
    setTimeout(function() {
      playLevel(whichLevelStr);
    }, 1000);
    console.log(levelSeqArr[whichLevelStr]);
    return;
  }
}
